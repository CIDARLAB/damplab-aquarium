
(function() {

  var w;
  try {
    w = angular.module('workflow_editor'); 
  } catch (e) {
    w = angular.module('workflow_editor', []); 
  }

  w.controller('workflowFormsCtrl', function ($scope,$http) {

    var that = this;
    this.nodes = [];
    this.workflow = { name: "...", specification: { description: "..." } };

    $scope.init = function(workflow) {
      that.workflow = workflow;
      angular.element('#details').scope().$apply();
    }

    $scope.show = function(selection,callback) {

      that.nodes = [];
      that.callback = callback;

      selection.each(function(node) {

        if (!(node instanceof go.Node)) return;
        $scope.node = node;
        that.nodes.push(node);

      });     

      angular.element('#details').scope().$apply();

    }

    $scope.save = function(node) {
      that.callback("rename_op",$scope.node);
    }

    $scope.save_part = function(node) {
      that.callback("rename_part",$scope.node);
    }

  });

  var names = [ 'operation', 'inventory', 'exceptions' ];

  for ( var i=0; i<names.length; i++ ) {
    (function(n) {
      w.directive(n, function() {
        var s = {};
        s[n] = '=';
        return {
          restrict: 'A',
          scope: s,
          templateUrl: "/workflow_editor/" + n + ".html" // this file is in ./public/
        };                                               // since putting it views confuses rails
      });  
    })(names[i]);
  }

})();
