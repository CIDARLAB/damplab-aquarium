<%= form_for(@sample) do |f| %>
  <% if @sample.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@sample.errors.count, "error") %> prohibited this sample from being saved:</h2>
      <ul>
      <% @sample.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

   <div class='row-fluid'>

    <div class='span3'>    

     <label>Name</label>
     <%= f.text_field :name %>

   </div><div class='span3'>    

    <label>Project </label>
    <%= f.text_field :project %>

   </div><div class='span3'>    

     <label>Owner</label>
     <%= f.select( :user_id, (User.all.collect { |u| [ u.login, u.id ]}).sort, selected: current_user.id ) %>

   </div><div class='span3'>    

     <div style='display: none'>
       <label>Type</label>
       <%= f.select( :sample_type_id, SampleType.all.collect { |st| [ st.name, st.id ] } ) %>
     </div> 

   </div>

  </div>

   <div class='row-fluid'>
     <div class='span9'>    
       <label>Description</label>
       <%= f.text_area :description, style: 'width: 100%;' ,rows: 1 %>
    </div>
  </div>

  <hr />

    <% (1..8).each do |i| 
       fn = "field#{i}name".to_sym
       ft = "field#{i}type".to_sym 
       ff = "field#{i}".to_sym %>
      <% if @sample_type[ft] != 'not used' && @sample_type[ft] != nil %>
        <label><%= @sample_type[fn] %> (<%= @sample_type[ft] %>)</label>
        <% if @sample_type[ft] == 'url' %>
          <%= f.url_field ff %>
        <% elsif @sample_type[ft] == 'number' %>
          <%= f.text_field ff %>
        <% elsif @sample_type[ft] == 'string' %>
          <%= f.text_field ff %>
        <% else %>

          <div class='sample-link'>
            <input id='sample_field<%= i %>' 
                 name='sample[field<%= i %>]' 
                 size=30
                 type='text'
                 data-sample='<%= @sample_type[ft] %>'
                 readonly
                 value='<%= @sample[ff] && @sample[ff] != "" ? @sample[ff] : "-none-" %>'>
            </input>
          </div>

        <% end %>
      <% end %>
    <% end %>

  <hr />

  <div class="actions">
    <%= f.submit "Save Sample Information", class: 'btn' %>
  </div>

<% end %>

<script>
  $('.sample-link').each ( function() {
    var d = $(this);
    var i = $('input', d);
    i.append(function() {
       d.append(new Finder(i.data('sample'),function(selections,names) {
         console.log(names[names.length-1]);
         i.val(names[names.length-1]);
       }));
    });
  });
</script>
