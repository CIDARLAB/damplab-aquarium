<div ng-app="aquarium" 
     ng-controller="sampleEditCtrl" 
     ng-init="info = { stid: <%= @sample_type.id %>, sid: <%= @sample.id ? @sample.id : 0 %> }"
     class='sample-type-edit'>

  <%= render partial: '/samples/templates/field_input' %>

  <h1>
    {{mode == 'edit' ? 'Edit' : 'New'}}
    {{sample.sample_type.name}}
    {{sample.id}} :
    <i>{{sample.name}}</i>
  </h1>

  <center>
  <p>{{sample.sample_type.description}}</p>
  </center>

  <div class='alert alert-error' ng-if="errors.length > 0">
    <button type="button" class="close" ng-click="clear_errors()">&times;</button>
    <ul>
    <li ng-repeat="e in errors">{{e}}</li>
    </ul>
  </div>

  <div class='alert alert-success' ng-if="messages.length > 0">
    <button type="button" class="close" ng-click="clear_messages()">&times;</button>
    <ul>
    <li ng-repeat="m in messages">{{m}}</li>
    </ul>
  </div>  

  <div ng-if="!ready">
    <p>Loading...</p>
  </div>

  <div ng-if="ready">

    <div class='row-fluid'>

      <div class='span3'>

        <h4>Name</h4>
        <input ng-model='sample.name' class="full bordered tall">

        <h4>Project</h4>
        <input ng-model='sample.project' class="full bordered tall">

        <h4>Description</h4>
        <textarea ng-model='sample.description' class="bordered"></textarea>

      </div>

      <div class='span9'>

        <h4>Properties</h4>

        <table style="table-layout: fixed">

          <tr ng-repeat="ft in sample.sample_type.field_types">

            <!-- NAME /////////////////////////////////////////////////////////////// -->
            <td>
              <b>{{ft.name}}</b>
            </td>

            <!-- TYPE /////////////////////////////////////////////////////////////// -->

            <td ng-if="ft.ftype == 'sample'">
              <span ng-repeat="aft in ft.allowable_field_types track by $index">
                <a href="/sample_types/{{aft.sample_type.id}}">{{aft.sample_type.name}}</a> 
                <span ng-if="!$last">|</span>
              </span>
              <span ng-if="ft.required" class="light">(required)</span>         
            </td>

            <td ng-if="ft.ftype != 'sample' && ft.ftype != 'item'">
              {{ft.ftype}}
              <span ng-if="ft.required" class="light">(required)</span>
            </td>

            <!-- VALUE ////////////////////////////////////////////////////////////// -->

            <td ng-include="'field_input'" style="width: 60%"></td>     

          </tr>

          <tr>
            <td colspan="3">TODO: Legacy field values here (if any).</td>
          </tr>

        </table>

      </div>

    </div>

    <a href="#" class='btn btn-primary' ng-click="save()">Save</a> 
    <%= link_to 'Cancel', samples_path(sample_type_id:@sample_type.id), class: 'btn' %> 

  </div>

    <!-- <pre>{{sample.field_values|json}}</pre> -->

</div>

<br />