<% provide(:title, 'Developer') %>

<div ng-app="aquarium" ng-controller="operationTypesCtrl as planner" class='operation_types'>

  <div class='two-column' ng-if="operation_types">

    <%= render partial: 'io_form' %>
    <%= render partial: 'show_block' %>
    <%= render partial: 'steps' %>     
    <%= render partial: 'code' %>   

    <div ng-if="!initialized">Loading ...</div>

    <div class='two-column-left' ng-if="initialized">

      <div class="two-column-control">

        <ul class='op-type-list'>    

          <li><br /></li>

          <li>
            <button class='btn btn-mini btn-primary' ng-click="new_operation_type()">New</button>
            <button class='btn btn-mini' ng-if="current_ot.id" ng-click="copy(current_ot)">Copy</button>

            <label class="btn btn-default btn-file btn-mini">
              Import <input type=file
                              id="import"
                              file="import"
                              style="display: none;"
                              custom-on-change="import">
            </label>

            <button class='btn btn-mini' ng-if="current_category" ng-click="export_category(current_category)">
              Export {{current_category}}
            </button>

          </li>

          <li><hr /></li>

          <li ng-repeat="category in categories track by $index">

            <b ng-click="choose_category(category)" class="no-highlight">
              <span ng-if="current_category != category">&#9658;</span>
              <span ng-if="current_category == category">&#9660;</span>             
              {{category}}
              ({{category_size(category)}})
            </b>

            <ul ng-if="current_category == category" class='op-type-sublist'>
              <li ng-repeat="ot in operation_types | filter: { category: category } : true track by $index" 
                  ng-click="choose(ot)"
                  ng-class="ot_class(ot)">{{ot.name}}</li>
            </ul>

          </li>

        </ul>

      </div>

    </div>
 
    <div class='two-column-right' ng-show="operation_types && current_ot"> 

      <ul class="nav nav-tabs">
        <li ng-class="tab('definition')"><a href="#" ng-click="set_mode('definition')">Definition</a></li>
        <li ng-class="tab('protocol')"><a href="#" ng-click="set_mode('protocol')">Protocol</a></li>
        <li ng-class="tab('precondition')"><a href="#" ng-click="set_mode('precondition')">Precondition</a></li>
        <li ng-class="tab('cost')"><a href="#" ng-click="set_mode('cost')">Cost</a></li>
        <li ng-class="tab('documentation')"><a href="#" ng-click="set_mode('documentation')">Documentation</a></li>
        <li ng-class="tab('test')"><a href="#" ng-click="set_mode('test')">Test</a></li>
      </ul> 

      <div class="ot-part-container">

        <%= render partial: 'definition' %>

        <div ng-include="'code'" ng-init="name='protocol'"      ng-if="current_ot.protocol && mode == 'protocol'" ></div>
        <div ng-include="'code'" ng-init="name='precondition'"  ng-if="current_ot.precondition && mode == 'precondition'"></div>
        <div ng-include="'code'" ng-init="name='cost_model'"    ng-if="current_ot.cost_model && mode == 'cost'"></div>        

        <div ng-include="'code'" ng-init="name='documentation'" ng-if="current_ot.documentation && mode == 'documentation'"></div>
        <div ng-if="current_ot.documentation && mode == 'documentation_view'" ng-controller="codeCtrl as code">
          <div ng-bind-html="current_ot.rendered_docs"></div>

          <div class='code-controls'>
            <a href='#' class='btn' 
                        ng-click="save(current_ot,'documentation')" 
                        ng-disabled="!current_ot.documentation.changed">Save</a>
            <a href='#' class='btn' ng-click="edit_docs(current_ot)">Edit</a>
          </div>  

        </div>  


        <%= render partial: 'test' %>

      </div>

    </div>

  </div>

</div>


