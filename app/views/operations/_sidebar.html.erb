<div layout="row">

  <div layout="column" class="category-container">

      <div ng-repeat="cat in categories track by $index"
          ng-click="current.category_index = $index; current.switch_user = false"
          ng-class="current.category_index == $index ? 
                               'no-highlight selected-category' : 
                               'no-highlight unselected-category'">
          {{cat}}
      </div>

      <hr>

      <% if current_user && current_user.is_admin %>

        <div ng-click="current.category_index = -1; current.switch_user = true"
             ng-class="current.switch_user ? 
                                 'no-highlight selected-category' : 
                                 'no-highlight unselected-category'">
            Switch User
        </div>

      <% end %>        

  </div>

  <table class='table table-condensed status-table'
         ng-if='!current.switch_user'>

    <tr>
      <th class='operation-name'>
        <md-switch ng-model="current.show_completed" aria-label="Show completed" style="padding-left: 16px; padding-top: 16px">
          Completed
        </md-switch>
      </th>
      <th ng-repeat="status in [ 'Waiting', 'Delayed', 'Pending', 'Deferred', 'Scheduled', 'Running', 'Error', 'Done' ]"
          class='rotate'
          ng-if="current.show_completed || ( status != 'Error' && status != 'Done' )">
        <div><span>{{status}}</span></div>
      </th>
    </tr>

    <tr ng-repeat="operation_type in operation_types | filter: { category: categories[current.category_index] }: true" 
        ng-click="choose(operation_type)">
      <td class="operation-name">
        <span ng-class="timing_bullet(operation_type)">&#9679;</span>
        {{operation_type.name}}
      </td>
      <td ng-repeat="status in [ 'waiting', 'delayed', 'pending', 'deferred', 'scheduled', 'running', 'error', 'done' ]"
          ng-class="$parent.status_selector(operation_type,status)"
          ng-click="$parent.select(operation_type,status)"
          ng-if="current.show_completed || ( status != 'error' && status != 'done' )">
          {{numbers[operation_type.id][status] ? numbers[operation_type.id][status] : 0}}
      </td>
    </tr>

  </table>

  <% if current_user && current_user.is_admin %>

    <div ng-if='current.switch_user' class="switch-user-container">

      <br>

      <div ng-if="users && users.length > 0">

        <div layout="row" layout-fill>

          <div flex="60">
            <md-switch ng-model="current.filter_user" 
                       aria-label="Filter User"
                       style="margin: 8px 0 0 32px">
              Filter by User 
            </md-switch>    
          </div>

          <div flex="40">
            <md-button class='md-raised' ng-disabled="applying_user_filter" ng-click="select_user()">Apply</md-button>
          </div>

        </div>

        <md-input-container layout-margin layout="column">
          <md-select ng-model="current.selected_user" 
                     class="md-plain-select">
            <md-option ng-repeat="user in users" 
                       ng-value="user"
                       ng-selected="user.id == current.selected_user.id">
              {{user.login}} ( {{user.name}} )
            </md-option>
          </md-select>
        </md-input-container>

      </div>

      <div ng-if="!users || users.length == 0">
        <p>Loading user list.</p>
      </div>

    </div>

  <% end %>

</div>