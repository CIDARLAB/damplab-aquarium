<!-- CURRENT OPERATION ////////////////////////////////// -->

<h2 class='md-subhead'>Current Plan<span ng-if="plan.id">: {{plan.id}}</span></h2>

<div style="margin-left: 16px; margin-top: 16px">
  <input type=text class="plan-name-input-" ng-model=plan.name>
</div>

<div ng-if="plan.current_module.id != 0">

  <h2 class='md-subhead'>Current Module</h2>

  <div style="margin-left: 16px; margin-top: 16px">
    <input type=text class="plan-name-input-" ng-model=plan.current_module.name>
  </div>

  <!-- <pre>{{plan.current_module|json}}</pre> -->

</div>

<br>
<md-divider></md-divider>

<div  style="margin-left: 16px">

  <!-- OPERATION TYPES /////////////////////////////////// -->

  <h4 class='md-subhead clickable no-highlight' ng-click="state.sidebar.op_types = !state.sidebar.op_types">
    <span class='opener'>{{state.sidebar.op_types ? '&#9660;' : '&#9658;'}}</span>  
    Operation Types
  </h4>

  <div ng-repeat="category in operation_types.categories | orderBy:''"
       ng-if="state.sidebar.op_types">
    
    <md-header ng-click="state.current_category = (state.current_category == category ? null : category)"
               class='clickable no-highlight' style="margin-left: 16px">
      <span class='opener'>
        {{state.current_category == category ? '&#9660;' : '&#9658;'}}
      </span>
      <span>{{category}}</span>
    </md-header>

    <md-list class='md-very-compact-list' 
             style="margin-left: 16px"
             ng-if="state.current_category == category">
      <md-list-item ng-repeat="ot in operation_types | filter: { category: category } | orderBy:'name'">
        <a href="#" ng-click="add_operation(ot)">
        {{ot.name | limitTo:32:0}}
        {{ot.name.length > 32 ? '...' : ''}}
        </a>
      </md-list-item>
    </md-list>      

  </div>

  <!-- TEMPLATES ///////////////////////////////////////////// -->

  <h4 class='md-subhead clickable no-highlight' ng-click="state.sidebar.templates = !state.sidebar.templates">
    <span class='opener'>{{state.sidebar.templates ? '&#9660;' : '&#9658;'}}</span>  
    Templates
  </h4>

  <div ng-if="state.sidebar.templates">

      <div class='clickable no-highlight' style="margin-left: 16px"
           ng-click="state.sidebar.system_templates = !state.sidebar.system_templates">
          <span class='opener'>{{state.sidebar.system_templates ? '&#9660;' : '&#9658;'}}</span> 
          System Templates
      </div>

      <md-list class='md-very-compact-list'
               ng-if="system_templates.length > 0 && state.sidebar.system_templates"
               style="margin-left: 16px">        
        <md-list-item ng-repeat="p in system_templates | orderBy:'-'" ">
          <a href='#' class='no-highlight' ng-click="paste_plan(p)">
            <span>{{p.id}}: {{p.name}}</span>
          </a>
        </md-list-item>
      </md-list>

      <span ng-if="system_templates.length == 0 && state.sidebar.system_templates" style="margin-left: 16px">No templates</span>

      <div class='clickable no-highlight' style="margin-left: 16px"
           ng-click="state.sidebar.your_templates = !state.sidebar.your_templates">
          <span class='opener'>{{state.sidebar.your_templates ? '&#9660;' : '&#9658;'}}</span> 
          Your Templates
      </div>

      <md-list class='md-very-compact-list'
               ng-if="templates.length > 0 && state.sidebar.your_templates"
               style="margin-left: 16px">        
        <md-list-item ng-repeat="p in templates | orderBy:'-'" ">
          <p><a href='#' class='no-highlight' ng-click="paste_plan(p)">
            {{p.id}}: {{p.name}}         
          </a></p>
          <% if current_user.is_admin %>
              <div class="md-secondary">
                <a href='#' style="font-size: 7pt" ng-click="create_system_template(p)">SHARE</a>
              </div>
          <% end %>             
        </md-list-item>
      </md-list>

      <span ng-if="templates.length == 0 && state.sidebar.your_templates" style="margin-left: 16px">No templates</span>

  </div>

  <!-- PLANS ///////////////////////////////////////////////// -->

  <h4 class='md-subhead clickable no-highlight' ng-click="state.sidebar.plans = !state.sidebar.plans">
  <span class='opener'>{{state.sidebar.plans ? '&#9660;' : '&#9658;'}}</span>  
  Your Plans {{state.loading_plans ? '... loading' : ''}}
  </h4>

  <md-list class='md-very-compact-list'
           ng-if="state.sidebar.plans">        
    <md-list-item ng-repeat="p in plans | orderBy:'-'" ">
      <a href='#' class='no-highlight' ng-click="load(p)">
        <span ng-if="p.id != plan.id">{{p.id}}: {{p.name}}</span>
        <span ng-if="p.id == plan.id"><b>{{p.id}}: {{p.name}}</b></span>
        <span ng-if="state.deleting_plan.id == p.id"> ... deleting </span>
      </a>
    </md-list-item>
  </md-list>

</div>