<% provide(:title, 'Planner') %>

<%= render partial: 'field_value_editor' %>
<%= render partial: 'operation_info' %>
<%= render partial: 'io_editor' %>
<%= render partial: '/data_associations/template' %> 
<%= render partial: "/items/template" %>

<% content_for :controller do %>planCtrl<% end %>
<% content_for :class do %>plans launcher<% end %>
<% content_for :no_main_scroll_decision do %>true<% end %>

<% content_for :specific_title do %>
  <span ng-if="current_op">&rang; {{current_op.operation_type.name}}</span>
  <span ng-if="current_fv">&rang; {{current_fv.name}}</span>
<% end %>

<% content_for :sidebar do %>

  {{plan.errors}}

  <div ng-if="ready" layout-fill style="padding: 16px">

    <div ng-if="!current_op && !current_fv">

      <h3 class='md-title'>Operation Types</h3>

      <div ng-repeat="category in operation_types.categories">
        
        <md-header ng-click="state.current_category = (state.current_category == category ? null : category)"
                   class='clickable no-highlight'>
          <span class='opener'>
            {{state.current_category == category ? '&#9660;' : '&#9658;'}}
          </span>
          <span>{{category}}</span>
        </md-header>

        <md-list class='md-compact-list' ng-if="state.current_category == category" >
          <md-list-item ng-repeat="ot in operation_types | filter: { category: category }">
            <a href="#" ng-click="add_operation(ot)">{{ot.name}}</a>
          </md-list-item>
        </md-list>      

      </div>

      <h3 class='md-title'>Plans {{state.loading_plans ? '... loading' : ''}}</h3>

      <md-list class='md-compact-list'>
        <md-list-item ng-repeat="plan in plans">
          <a href='#' class='no-highlight' ng-click="load(plan)">{{plan.id}}: {{plan.name}}</a>
        </md-list-item>
      </md-list>

    </div>

    <div ng-if="current_op && !current_fv" 
         ng-include="'operation_info'">
    </div>

    <div ng-if="current_fv"
         ng-include="'field_value_editor'">
    </div>

  </div>

<% end %>

<% content_for :action1 do %>
  <md-button class='md-raised md-primary' ng-click="save(plan)" ng-disabled="plan.saving">Save</md-button>
<% end %>

<% content_for :action2 do %>
  <md-button class='md-raised'>Launch</md-button>
<% end %>

<% content_for :main do %>

  <div flex layout-padding ng-if="!ready">
    <div layout="row">
      <div flex="34"></div>
      <div flex="66">
        <br /><br />
        <h2 class="md-title">Loading ...</h2>
        <br />
        <md-progress-linear md-mode="indeterminate"></md-progress-linear>
      </div>
    </div>
  </div>  

  <div class="editor-main" layout="column" ng-if="ready">

    <div flex class="plan-editor-container scrollable"
         ng-keydown="keyDown($event)" tabindex="0">
      <%= render partial: 'plan_editor' %>
    </div>

    <div class="wrapper operation-editor scrollable">
      <inner>
        <%= render partial: 'operation_editor' %>
      </inner>
    </div>   

  </div>

<% end %>


