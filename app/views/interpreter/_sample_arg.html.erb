<div class='well row-fluid'>

<% type = arg.name.sub('_id','').capitalize %>
<% st = SampleType.find_by_name(type) %>

<% if st %>

  <div class='span6'>
    
    <div id='<%= arg.name + "_temp" %>' style='display: none'></div>

    <%= label_tag(arg.name.to_sym,arg.description+' ('+type+')' ) %>
    <select id='<%= arg.name %>' name='<%= arg.name %>'>
      <% st.samples.each do |s| %>
        <% s.items.each do |i| %>
          <option value='<%= i.id %>' project='<%= s.project %>'><%= "#{i.id}: #{s.name}" %></option>
        <% end %>
      <% end %>
    </select>

    <select id='<%= arg.name + '_hidden' %>' style='display:none'></select>

  </div><div class='span6'>

    <% projects = (SampleType.all.first.samples.collect { |x| x.project }).uniq %>

    <label>Project</label>
    <select id='<%= arg.name + '_project' %>' onchange="filter_by_sample_project('<%= arg.name %>')">
      <% projects.each do |p| %>
        <option value=<%= p %>><%= p %></option>
      <% end %>
    </select>

  </div>

<% else %>

  <%= label_tag(arg.name.to_sym, arg.description ) %>
  <%= text_field_tag( arg.name.to_sym ) %>

<% end %>

</div>

<script>

  function filter_by_sample_project(arg_name) {

    s = document.getElementById(arg_name);
    h = document.getElementById(arg_name+'_hidden');
    p = document.getElementById(arg_name+'_project');
    t = document.getElementById(arg_name+'_temp');

    project = p.options[p.selectedIndex].value;

    //console.log(arg_name + " => " + project);

    while ( s.children.length > 0 ) {
      //console.log ( s.children[0].getAttribute('project') );
      t.appendChild(s.children[0]);
    }

    while ( h.children.length > 0 ) {
      t.appendChild(h.children[0]);
    }

    while ( t.children.length > 0 )  {
     // console.log ( t.children[0].getAttribute('project') );
      if ( t.children[0].getAttribute('project') != project ) {
        h.appendChild(t.children[0]);
      } else {
        s.appendChild(t.children[0]);
      }
    }
  }

 <% if st %>
   filter_by_sample_project('<%= arg.name %>');
 <% end %>

</script>

<script>

sample_items = [
<% SampleType.all.each do |st| %>
  <% st.samples.each do |s| %>
    <% s.items.each do |i| %>
      { id: <%= i.id %>, name: '<%= s.id %>', project: '<%=s.project %>', object_type: '<%= i.object_type.name %>'},
    <% end %>
  <% end %>
<% end %>
];

</script>

