<% height = '100vh' %>

<div ng-app="workflow">

  <style>
    canvas {
      outline: none;
      -webkit-tap-highlight-color: rgba(255, 255, 255, 0); /* mobile webkit */
    }
    .details-list {
      list-style-type: none;
    }
  </style>

  <div class="row-fluid">

    <div id="controls" class="span1" style="border: 1pt solid #eee; height: <%= height %>">
      <div style="margin: 10px">
        <button class="btn btn-block" id="AddButton" onclick="add()">Add</button>
        <button class="btn btn-block" id="SaveButton" onclick="save()">JSON</button>
      </div>
    </div>

    <div class="span8">
      <div id="workflow" style="height:<%= height %>;">
      </div>
    </div>

    <div class="span3" style="border: 1pt solid #eee; height: <%= height %>">
      <div id="details" style="margin: 10px" ng-controller="workflowFormsCtrl as workflow">
        <ul>
          <li ng-repeat="node in workflow.nodes" class="details-list">
            <div ng-if="node.category == 'operation'">
              <operation node="node"></operation>
            </div>
            <div ng-if="node.category == 'inventory'">
              <inventory node="node"></inventory>
            </div>
            <hr />        
          </li>
          </ul>
      </div>
    </div>

  </div>

</div>

<span id="workflow-data"></span>

<script>

  $(function() {
    o = go.GraphObject.make;
    we = new WorkflowEditor(<%= params[:id] %>,"workflow","workflow-data");
  });

  function save() {
    document.getElementById("workflow-data").value = we.json();
  }

  function add() {
    we.addOperation();
  }  

</script>