<% provide(:title, params[:path]) %>

<h1>Start Metacol: <%= params[:path] %></h1>

<% if Rails.env == 'production' %>
  <center>
  <p><span class="alert alert-error">Note: You should only start a
    metacol on the production server if you are physically in the lab
    at the bench working.</span></p>
  </center>
<% end %>

<% if @errors != "" %>

  <h4>Error</h4>

  <div id='well'>
    <p><%= @errors %></p>
  </div>
<pre><%= @content %></pre> 
<% else %>

<h4>Arguments</h4>
<div id='argument-chooser'></div>

<br />

<h4>Group</h4>
<div id='group-chooser'></div>

<br />
<div id='button-area'></div>
  <%= render 'details' %>
<% end %>


<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <h4 id="myModalLabel">Launching <%= @path %></h4>
  </div>
  <div class="modal-body">
    <center><%= image_tag 'waiting_animation.gif' %></center>
  </div>
</div>

<script>


<% if @errors == "" %>

  // get arguments
  var args = [];
  <% @metacol.arguments.each do |a| %>
    args.push({
      name: '<%= a[:name] %>', 
      description: '<%= a[:description] %>',
      type: '<%= a[:type] %>'
    });
  <% end %>

  <%= render partial: 'interpreter/build_cart' %>
  <%= render partial: 'interpreter/build_objects' %>
  <%= render partial: 'interpreter/build_groups' %>

  // run javascript ui maker thingy
  ac = new ArgumentUI('<%= @sha %>',args,cart,objects);
  ac.metacol = true;
  ac.path = '<%= @path %>';
  ac.display_form();
  ac.display_groups(groups,users,'<%= current_user.login %>');

  document.getElementById('launch-button').onclick = splash_launch_alert;

  function splash_launch_alert() {
    $('#myModal').modal();
  }

<% end %>

</script>
